<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bingo.erp.xo.order.mapper.StoreRecordInfoMapper">

    <select id="queryStoreRecordStatement" parameterType="com.bingo.erp.xo.order.vo.StatementQueryVO" resultType="com.bingo.erp.xo.order.vo.StatementResultVO">
        SELECT
        <choose>
            <when test="dateType != null and dateType == '1'.toString()">
                year(create_time) as createTime,
            </when>
            <when test="dateType != null and dateType == '2'.toString()">
                date_format(create_time, '%Y-%m') as createTime,
            </when>
            <otherwise>
                date(create_time) as createTime,
            </otherwise>
        </choose>
          material_status,
          <if test="isPartName or materialName != null and materialName != ''">
            material_name,
          </if>

          <if test="isPartColor or materialColor != null and materialColor != ''">
            material_color,
          </if>
	      sum(total_price) total_price,
	      SUM(material_num) total_num
        FROM
	      s_record_info
	    where 1=1 and status = 1
	    <if test="materialName != null and materialName != ''">
            and material_name = #{materialName}
        </if>
        <if test="materialColor != null and materialColor != ''">
            and material_color = #{materialColor}
        </if>
        GROUP BY
        material_status,
        <if test="isPartName">
            material_name,
        </if>
        <if test="isPartColor">
            material_color,
        </if>
        <choose>
            <when test="dateType != null and dateType == '1'.toString()">
                year(create_time) order by year(create_time) desc
            </when>
            <when test="dateType != null and dateType == '2'.toString()">
                date_format(create_time, '%Y-%m') order by date_format(create_time, '%Y-%m') desc
            </when>
            <otherwise>
                date(create_time) order by date(create_time) desc
            </otherwise>
        </choose>

    </select>

</mapper>